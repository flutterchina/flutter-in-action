(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{600:function(t,a,s){t.exports=s.p+"assets/img/3-1.587e85ad.png"},601:function(t,a,s){t.exports=s.p+"assets/img/3-1-1.63daca67.png"},602:function(t,a,s){t.exports=s.p+"assets/img/3-2.a59bef97.jpg"},603:function(t,a,s){t.exports=s.p+"assets/img/3-1-2.70506d6d.png"},604:function(t,a,s){t.exports=s.p+"assets/img/3-3.3b5b2dd3.png"},888:function(t,a,s){"use strict";s.r(a);var e=s(45),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"_3-1-widget简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-widget简介"}},[t._v("#")]),t._v(" 3.1 Widget简介")]),t._v(" "),e("h2",{attrs:{id:"_3-1-1-概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-概念"}},[t._v("#")]),t._v(" 3.1.1 概念")]),t._v(" "),e("p",[t._v("在前面的介绍中，我们知道在Flutter中几乎所有的对象都是一个Widget。与原生开发中“控件”不同的是，Flutter中的Widget的概念更广泛，它不仅可以表示UI元素，也可以表示一些功能性的组件如：用于手势检测的 "),e("code",[t._v("GestureDetector")]),t._v(" widget、用于APP主题数据传递的"),e("code",[t._v("Theme")]),t._v("等等，而原生开发中的控件通常只是指UI元素。在后面的内容中，我们在描述UI元素时可能会用到“控件”、“组件”这样的概念，读者心里需要知道他们就是widget，只是在不同场景的不同表述而已。由于Flutter主要就是用于构建用户界面的，所以，在大多数时候，读者可以认为widget就是一个控件，不必纠结于概念。")]),t._v(" "),e("h2",{attrs:{id:"_3-1-2-widget与element"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-widget与element"}},[t._v("#")]),t._v(" 3.1.2 Widget与Element")]),t._v(" "),e("p",[t._v("在Flutter中，Widget的功能是“描述一个UI元素的配置数据”，它就是说，Widget其实并不是表示最终绘制在设备屏幕上的显示元素，而它只是描述显示元素的一个配置数据。")]),t._v(" "),e("p",[t._v("实际上，Flutter中真正代表屏幕上显示元素的类是"),e("code",[t._v("Element")]),t._v("，也就是说Widget只是描述"),e("code",[t._v("Element")]),t._v("的配置数据！有关"),e("code",[t._v("Element")]),t._v("的详细介绍我们将在本书后面的高级部分深入介绍，现在，读者只需要知道："),e("strong",[t._v("Widget只是UI元素的一个配置数据，并且一个Widget可以对应多个"),e("code",[t._v("Element")])]),t._v("。这是因为同一个Widget对象可以被添加到UI树的不同部分，而真正渲染时，UI树的每一个"),e("code",[t._v("Element")]),t._v("节点都会对应一个Widget对象。总结一下：")]),t._v(" "),e("ul",[e("li",[t._v("Widget实际上就是"),e("code",[t._v("Element")]),t._v("的配置数据，Widget树实际上是一个配置树，而真正的UI渲染树是由"),e("code",[t._v("Element")]),t._v("构成；不过，由于"),e("code",[t._v("Element")]),t._v("是通过Widget生成的，所以它们之间有对应关系，在大多数场景，我们可以宽泛地认为Widget树就是指UI控件树或UI渲染树。")]),t._v(" "),e("li",[t._v("一个Widget对象可以对应多个"),e("code",[t._v("Element")]),t._v("对象。这很好理解，根据同一份配置（Widget），可以创建多个实例（Element）。")])]),t._v(" "),e("p",[t._v("读者应该将这两点牢记在心中。")]),t._v(" "),e("h2",{attrs:{id:"_3-1-3-widget主要接口"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-3-widget主要接口"}},[t._v("#")]),t._v(" 3.1.3 Widget主要接口")]),t._v(" "),e("p",[t._v("我们先来看一下Widget类的声明：")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@immutable")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("abstract")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Widget")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DiagnosticableTree")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Widget")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" Key key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n  "),e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@protected")]),t._v("\n  Element "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  String "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("toStringShort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" key "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$runtimeType'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$runtimeType-$key'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("debugFillProperties")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DiagnosticPropertiesBuilder properties"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("debugFillProperties")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("properties"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    properties"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("defaultDiagnosticsTreeStyle "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" DiagnosticsTreeStyle"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dense"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  \n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" bool "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("canUpdate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Widget oldWidget"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Widget newWidget"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" oldWidget"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("runtimeType "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" newWidget"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("runtimeType\n        "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" oldWidget"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" newWidget"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("ul",[e("li",[e("code",[t._v("Widget")]),t._v("类继承自"),e("code",[t._v("DiagnosticableTree")]),t._v("，"),e("code",[t._v("DiagnosticableTree")]),t._v("即“诊断树”，主要作用是提供调试信息。")]),t._v(" "),e("li",[e("code",[t._v("Key")]),t._v(": 这个"),e("code",[t._v("key")]),t._v("属性类似于React/Vue中的"),e("code",[t._v("key")]),t._v("，主要的作用是决定是否在下一次"),e("code",[t._v("build")]),t._v("时复用旧的widget，决定的条件在"),e("code",[t._v("canUpdate()")]),t._v("方法中。")]),t._v(" "),e("li",[e("code",[t._v("createElement()")]),t._v("：正如前文所述“一个Widget可以对应多个"),e("code",[t._v("Element")]),t._v("”；Flutter Framework在构建UI树时，会先调用此方法生成对应节点的"),e("code",[t._v("Element")]),t._v("对象。此方法是Flutter Framework隐式调用的，在我们开发过程中基本不会调用到。")]),t._v(" "),e("li",[e("code",[t._v("debugFillProperties(...)")]),t._v(" 复写父类的方法，主要是设置诊断树的一些特性。")]),t._v(" "),e("li",[e("code",[t._v("canUpdate(...)")]),t._v("是一个静态方法，它主要用于在Widget树重新"),e("code",[t._v("build")]),t._v("时复用旧的widget，其实具体来说，应该是：是否用新的Widget对象去更新旧UI树上所对应的"),e("code",[t._v("Element")]),t._v("对象的配置；通过其源码我们可以看到，只要"),e("code",[t._v("newWidget")]),t._v("与"),e("code",[t._v("oldWidget")]),t._v("的"),e("code",[t._v("runtimeType")]),t._v("和"),e("code",[t._v("key")]),t._v("同时相等时就会用"),e("code",[t._v("newWidget")]),t._v("去更新"),e("code",[t._v("Element")]),t._v("对象的配置，否则就会创建新的"),e("code",[t._v("Element")]),t._v("。")])]),t._v(" "),e("p",[t._v("有关Key和Widget复用的细节将会在本书后面高级部分深入讨论，读者现在只需知道，为Widget显式添加key的话可能（但不一定）会使UI在重新构建时变的高效，读者目前可以先忽略此参数。本书后面的示例中，只会在构建列表项UI时会显式指定Key。")]),t._v(" "),e("p",[t._v("另外"),e("code",[t._v("Widget")]),t._v("类本身是一个抽象类，其中最核心的就是定义了"),e("code",[t._v("createElement()")]),t._v("接口，在Flutter开发中，我们一般都不用直接继承"),e("code",[t._v("Widget")]),t._v("类来实现一个新组件，相反，我们通常会通过继承"),e("code",[t._v("StatelessWidget")]),t._v("或"),e("code",[t._v("StatefulWidget")]),t._v("来间接继承"),e("code",[t._v("Widget")]),t._v("类来实现。"),e("code",[t._v("StatelessWidget")]),t._v("和"),e("code",[t._v("StatefulWidget")]),t._v("都是直接继承自"),e("code",[t._v("Widget")]),t._v("类，而这两个类也正是Flutter中非常重要的两个抽象类，它们引入了两种Widget模型，接下来我们将重点介绍一下这两个类。")]),t._v(" "),e("h2",{attrs:{id:"_3-1-4-statelesswidget"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-4-statelesswidget"}},[t._v("#")]),t._v(" 3.1.4 StatelessWidget")]),t._v(" "),e("p",[t._v("在之前的章节中，我们已经简单介绍过"),e("code",[t._v("StatelessWidget")]),t._v("，"),e("code",[t._v("StatelessWidget")]),t._v("相对比较简单，它继承自"),e("code",[t._v("Widget")]),t._v("类，重写了"),e("code",[t._v("createElement()")]),t._v("方法：")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\nStatelessElement "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StatelessElement")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[e("code",[t._v("StatelessElement")]),t._v(" 间接继承自"),e("code",[t._v("Element")]),t._v("类，与"),e("code",[t._v("StatelessWidget")]),t._v("相对应（作为其配置数据）。")]),t._v(" "),e("p",[e("code",[t._v("StatelessWidget")]),t._v("用于不需要维护状态的场景，它通常在"),e("code",[t._v("build")]),t._v("方法中通过嵌套其它Widget来构建UI，在构建过程中会递归的构建其嵌套的Widget。我们看一个简单的例子：")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Echo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StatelessWidget")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Echo")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    Key key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n    "),e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@required")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("backgroundColor"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Colors"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("grey"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" String text"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" Color backgroundColor"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  Widget "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BuildContext context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Center")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      child"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Container")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        color"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" backgroundColor"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        child"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Text")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("text"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("上面的代码，实现了一个回显字符串的"),e("code",[t._v("Echo")]),t._v(" widget。")]),t._v(" "),e("blockquote",[e("p",[t._v("按照惯例，"),e("code",[t._v("widget")]),t._v("的构造函数参数应使用命名参数，命名参数中的必要参数要添加"),e("code",[t._v("@required")]),t._v("标注，这样有利于静态代码分析器进行检查。另外，在继承"),e("code",[t._v("widget")]),t._v("时，第一个参数通常应该是"),e("code",[t._v("Key")]),t._v("，另外，如果Widget需要接收子Widget，那么"),e("code",[t._v("child")]),t._v("或"),e("code",[t._v("children")]),t._v("参数通常应被放在参数列表的最后。同样是按照惯例，Widget的属性应尽可能的被声明为"),e("code",[t._v("final")]),t._v("，防止被意外改变。")])]),t._v(" "),e("p",[t._v("然后我们可以通过如下方式使用它：")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[t._v("Widget "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BuildContext context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Echo")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("text"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello world"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("运行后效果如图3-1所示：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(600),alt:"图3-1"}})]),t._v(" "),e("h3",{attrs:{id:"context"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#context"}},[t._v("#")]),t._v(" Context")]),t._v(" "),e("p",[e("code",[t._v("build")]),t._v("方法有一个"),e("code",[t._v("context")]),t._v("参数，它是"),e("code",[t._v("BuildContext")]),t._v("类的一个实例，表示当前widget在widget树中的上下文，每一个widget都会对应一个context对象（因为每一个widget都是widget树上的一个节点）。实际上，"),e("code",[t._v("context")]),t._v("是当前widget在widget树中位置中执行”相关操作“的一个句柄，比如它提供了从当前widget开始向上遍历widget树以及按照widget类型查找父级widget的方法。下面是在子树中获取父级widget的一个示例：")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ContextRoute")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StatelessWidget")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  Widget "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BuildContext context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Scaffold")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      appBar"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("AppBar")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        title"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Text")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Context测试"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      body"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Container")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        child"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Builder")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("builder"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在Widget树中向上查找最近的父级`Scaffold` widget")]),t._v("\n          Scaffold scaffold "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("findAncestorWidgetOfExactType"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Scaffold"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 直接返回 AppBar的title， 此处实际上是Text("Context测试")')]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("scaffold"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("appBar "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("as")]),t._v(" AppBar"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("运行后效果如图3-1-1所示：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(601),alt:"图3-1-1"}})]),t._v(" "),e("blockquote",[e("p",[e("strong",[t._v("注意")]),t._v("：对于"),e("code",[t._v("BuildContext")]),t._v("读者现在可以先作了解，随着本书后面内容的展开，也会用到Context的一些方法，读者可以通过具体的场景对其有个直观的认识。关于"),e("code",[t._v("BuildContext")]),t._v("更多的内容，我们也将在后面高级部分再深入介绍。")])]),t._v(" "),e("h2",{attrs:{id:"_3-1-5-statefulwidget"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-5-statefulwidget"}},[t._v("#")]),t._v(" 3.1.5 StatefulWidget")]),t._v(" "),e("p",[t._v("和"),e("code",[t._v("StatelessWidget")]),t._v("一样，"),e("code",[t._v("StatefulWidget")]),t._v("也是继承自"),e("code",[t._v("Widget")]),t._v("类，并重写了"),e("code",[t._v("createElement()")]),t._v("方法，不同的是返回的"),e("code",[t._v("Element")]),t._v(" 对象并不相同；另外"),e("code",[t._v("StatefulWidget")]),t._v("类中添加了一个新的接口"),e("code",[t._v("createState()")]),t._v("。")]),t._v(" "),e("p",[t._v("下面我们看看"),e("code",[t._v("StatefulWidget")]),t._v("的类定义：")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("abstract")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StatefulWidget")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Widget")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("StatefulWidget")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Key key "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n  "),e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  StatefulElement "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StatefulElement")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n  "),e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@protected")]),t._v("\n  State "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createState")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("ul",[e("li",[e("p",[e("code",[t._v("StatefulElement")]),t._v(" 间接继承自"),e("code",[t._v("Element")]),t._v("类，与StatefulWidget相对应（作为其配置数据）。"),e("code",[t._v("StatefulElement")]),t._v("中可能会多次调用"),e("code",[t._v("createState()")]),t._v("来创建状态(State)对象。")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("createState()")]),t._v(" 用于创建和Stateful widget相关的状态，它在Stateful widget的生命周期中可能会被多次调用。例如，当一个Stateful widget同时插入到widget树的多个位置时，Flutter framework就会调用该方法为每一个位置生成一个独立的State实例，其实，本质上就是一个"),e("code",[t._v("StatefulElement")]),t._v("对应一个State实例。")]),t._v(" "),e("blockquote",[e("p",[t._v("在本书中经常会出现“树”的概念，在不同的场景可能指不同的意思，在说“widget树”时它可以指widget结构树，但由于widget与Element有对应关系（一可能对多），在有些场景（Flutter的SDK文档中）也代指“UI树”的意思。而在stateful widget中，State对象也和"),e("code",[t._v("StatefulElement")]),t._v("具有对应关系（一对一），所以在Flutter的SDK文档中，可以经常看到“从树中移除State对象”或“插入State对象到树中”这样的描述。其实，无论哪种描述，其意思都是在描述“一棵构成用户界面的节点元素的树”，读者不必纠结于这些概念，还是那句话“得其神，忘其形”，因此，本书中出现的各种“树”，如果没有特别说明，读者都可抽象的认为它是“一棵构成用户界面的节点元素的树”。")])])])]),t._v(" "),e("h2",{attrs:{id:"_3-1-6-state"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-6-state"}},[t._v("#")]),t._v(" 3.1.6 State")]),t._v(" "),e("p",[t._v("一个StatefulWidget类会对应一个State类，State表示与其对应的StatefulWidget要维护的状态，State中的保存的状态信息可以：")]),t._v(" "),e("ol",[e("li",[t._v("在widget 构建时可以被同步读取。")]),t._v(" "),e("li",[t._v("在widget生命周期中可以被改变，当State被改变时，可以手动调用其"),e("code",[t._v("setState()")]),t._v("方法通知Flutter framework状态发生改变，Flutter framework在收到消息后，会重新调用其"),e("code",[t._v("build")]),t._v("方法重新构建widget树，从而达到更新UI的目的。")])]),t._v(" "),e("p",[t._v("State中有两个常用属性：")]),t._v(" "),e("ol",[e("li",[e("p",[e("code",[t._v("widget")]),t._v("，它表示与该State实例关联的widget实例，由Flutter framework动态设置。注意，这种关联并非永久的，因为在应用生命周期中，UI树上的某一个节点的widget实例在重新构建时可能会变化，但State实例只会在第一次插入到树中时被创建，当在重新构建时，如果widget被修改了，Flutter framework会动态设置State.widget为新的widget实例。")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("context")]),t._v("。StatefulWidget对应的BuildContext，作用同StatelessWidget的BuildContext。")])])]),t._v(" "),e("h4",{attrs:{id:"state生命周期"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#state生命周期"}},[t._v("#")]),t._v(" State生命周期")]),t._v(" "),e("p",[t._v("理解State的生命周期对flutter开发非常重要，为了加深读者印象，本节我们通过一个实例来演示一下State的生命周期。在接下来的示例中，我们实现一个计数器widget，点击它可以使计数器加1，由于要保存计数器的数值状态，所以我们应继承StatefulWidget，代码如下：")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CounterWidget")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StatefulWidget")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CounterWidget")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    Key key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("initValue"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" int initValue"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  _CounterWidgetState "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createState")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("_CounterWidgetState")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[e("code",[t._v("CounterWidget")]),t._v("接收一个"),e("code",[t._v("initValue")]),t._v("整型参数，它表示计数器的初始值。下面我们看一下State的代码：")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("_CounterWidgetState")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("State")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("CounterWidget"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n  int _counter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("initState")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("initState")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//初始化状态  ")]),t._v("\n    _counter"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("widget"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("initValue"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"initState"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  Widget "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BuildContext context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"build"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Scaffold")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      body"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Center")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        child"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("FlatButton")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n          child"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Text")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$_counter'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//点击后计数器自增")]),t._v("\n          onPressed"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setState")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("_counter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("didUpdateWidget")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CounterWidget oldWidget"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("didUpdateWidget")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldWidget"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"didUpdateWidget"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("deactivate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("deactivate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"deactive"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispose")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispose")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dispose"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("reassemble")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("reassemble")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"reassemble"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("didChangeDependencies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("didChangeDependencies")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"didChangeDependencies"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("接下来，我们创建一个新路由，在新路由中，我们只显示一个"),e("code",[t._v("CounterWidget")]),t._v("：")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[t._v("Widget "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BuildContext context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CounterWidget")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("我们运行应用并打开该路由页面，在新路由页打开后，屏幕中央就会出现一个数字0，然后控制台日志输出：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("I/flutter ( 5436): initState\nI/flutter ( 5436): didChangeDependencies\nI/flutter ( 5436): build\n")])])]),e("p",[t._v("可以看到，在StatefulWidget插入到Widget树时首先"),e("code",[t._v("initState")]),t._v("方法会被调用。")]),t._v(" "),e("p",[t._v("然后我们点击⚡️按钮热重载，控制台输出日志如下：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("I/flutter ( 5436): reassemble\nI/flutter ( 5436): didUpdateWidget\nI/flutter ( 5436): build\n")])])]),e("p",[t._v("可以看到此时"),e("code",[t._v("initState")]),t._v(" 和"),e("code",[t._v("didChangeDependencies")]),t._v("都没有被调用，而此时"),e("code",[t._v("didUpdateWidget")]),t._v("被调用。")]),t._v(" "),e("p",[t._v("接下来，我们在widget树中移除"),e("code",[t._v("CounterWidget")]),t._v("，将路由"),e("code",[t._v("build")]),t._v("方法改为：")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[t._v("Widget "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BuildContext context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//移除计数器 ")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//return CounterWidget();")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//随便返回一个Text()")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Text")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxx"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("然后热重载，日志如下：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("I/flutter ( 5436): reassemble\nI/flutter ( 5436): deactive\nI/flutter ( 5436): dispose\n")])])]),e("p",[t._v("我们可以看到，在"),e("code",[t._v("CounterWidget")]),t._v("从widget树中移除时，"),e("code",[t._v("deactive")]),t._v("和"),e("code",[t._v("dispose")]),t._v("会依次被调用。")]),t._v(" "),e("p",[t._v("下面我们来看看各个回调函数：")]),t._v(" "),e("ul",[e("li",[e("p",[e("code",[t._v("initState")]),t._v("：当Widget第一次插入到Widget树时会被调用，对于每一个State对象，Flutter framework只会调用一次该回调，所以，通常在该回调中做一些一次性的操作，如状态初始化、订阅子树的事件通知等。不能在该回调中调用"),e("code",[t._v("BuildContext.dependOnInheritedWidgetOfExactType")]),t._v("（该方法用于在Widget树上获取离当前widget最近的一个父级"),e("code",[t._v("InheritFromWidget")]),t._v("，关于"),e("code",[t._v("InheritedWidget")]),t._v("我们将在后面章节介绍），原因是在初始化完成后，Widget树中的"),e("code",[t._v("InheritFromWidget")]),t._v("也可能会发生变化，所以正确的做法应该在在"),e("code",[t._v("build（）")]),t._v("方法或"),e("code",[t._v("didChangeDependencies()")]),t._v("中调用它。")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("didChangeDependencies()")]),t._v("：当State对象的依赖发生变化时会被调用；例如：在之前"),e("code",[t._v("build()")]),t._v(" 中包含了一个"),e("code",[t._v("InheritedWidget")]),t._v("，然后在之后的"),e("code",[t._v("build()")]),t._v(" 中"),e("code",[t._v("InheritedWidget")]),t._v("发生了变化，那么此时"),e("code",[t._v("InheritedWidget")]),t._v("的子widget的"),e("code",[t._v("didChangeDependencies()")]),t._v("回调都会被调用。典型的场景是当系统语言Locale或应用主题改变时，Flutter framework会通知widget调用此回调。")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("build()")]),t._v("：此回调读者现在应该已经相当熟悉了，它主要是用于构建Widget子树的，会在如下场景被调用：")]),t._v(" "),e("ol",[e("li",[t._v("在调用"),e("code",[t._v("initState()")]),t._v("之后。")]),t._v(" "),e("li",[t._v("在调用"),e("code",[t._v("didUpdateWidget()")]),t._v("之后。")]),t._v(" "),e("li",[t._v("在调用"),e("code",[t._v("setState()")]),t._v("之后。")]),t._v(" "),e("li",[t._v("在调用"),e("code",[t._v("didChangeDependencies()")]),t._v("之后。")]),t._v(" "),e("li",[t._v("在State对象从树中一个位置移除后（会调用deactivate）又重新插入到树的其它位置之后。")])])]),t._v(" "),e("li",[e("p",[e("code",[t._v("reassemble()")]),t._v("：此回调是专门为了开发调试而提供的，在热重载(hot reload)时会被调用，此回调在Release模式下永远不会被调用。")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("didUpdateWidget()")]),t._v("：在widget重新构建时，Flutter framework会调用"),e("code",[t._v("Widget.canUpdate")]),t._v("来检测Widget树中同一位置的新旧节点，然后决定是否需要更新，如果"),e("code",[t._v("Widget.canUpdate")]),t._v("返回"),e("code",[t._v("true")]),t._v("则会调用此回调。正如之前所述，"),e("code",[t._v("Widget.canUpdate")]),t._v("会在新旧widget的key和runtimeType同时相等时会返回true，也就是说在在新旧widget的key和runtimeType同时相等时"),e("code",[t._v("didUpdateWidget()")]),t._v("就会被调用。")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("deactivate()")]),t._v("：当State对象从树中被移除时，会调用此回调。在一些场景下，Flutter framework会将State对象重新插到树中，如包含此State对象的子树在树的一个位置移动到另一个位置时（可以通过GlobalKey来实现）。如果移除后没有重新插入到树中则紧接着会调用"),e("code",[t._v("dispose()")]),t._v("方法。")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("dispose()")]),t._v("：当State对象从树中被永久移除时调用；通常在此回调中释放资源。")])])]),t._v(" "),e("p",[t._v("StatefulWidget生命周期如图3-2所示：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(602),alt:"图3-2"}})]),t._v(" "),e("blockquote",[e("p",[e("strong",[t._v("注意")]),t._v("：在继承"),e("code",[t._v("StatefulWidget")]),t._v("重写其方法时，对于包含"),e("code",[t._v("@mustCallSuper")]),t._v("标注的父类方法，都要在子类方法中先调用父类方法。")])]),t._v(" "),e("h3",{attrs:{id:"为什么要将build方法放在state中-而不是放在statefulwidget中"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#为什么要将build方法放在state中-而不是放在statefulwidget中"}},[t._v("#")]),t._v(" 为什么要将build方法放在State中，而不是放在StatefulWidget中？")]),t._v(" "),e("p",[t._v("现在，我们回答之前提出的问题，为什么"),e("code",[t._v("build()")]),t._v("方法放在State（而不是"),e("code",[t._v("StatefulWidget")]),t._v("）中 ？这主要是为了提高开发的灵活性。如果将"),e("code",[t._v("build()")]),t._v("方法在"),e("code",[t._v("StatefulWidget")]),t._v("中则会有两个问题：")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("状态访问不便。")]),t._v(" "),e("p",[t._v("试想一下，如果我们的"),e("code",[t._v("StatefulWidget")]),t._v("有很多状态，而每次状态改变都要调用"),e("code",[t._v("build")]),t._v("方法，由于状态是保存在State中的，如果"),e("code",[t._v("build")]),t._v("方法在"),e("code",[t._v("StatefulWidget")]),t._v("中，那么"),e("code",[t._v("build")]),t._v("方法和状态分别在两个类中，那么构建时读取状态将会很不方便！试想一下，如果真的将"),e("code",[t._v("build")]),t._v("方法放在StatefulWidget中的话，由于构建用户界面过程需要依赖State，所以"),e("code",[t._v("build")]),t._v("方法将必须加一个"),e("code",[t._v("State")]),t._v("参数，大概是下面这样：")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[t._v("  Widget "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BuildContext context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" State state"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//state.counter")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("这样的话就只能将State的所有状态声明为公开的状态，这样才能在State类外部访问状态！但是，将状态设置为公开后，状态将不再具有私密性，这就会导致对状态的修改将会变的不可控。但如果将"),e("code",[t._v("build()")]),t._v("方法放在State中的话，构建过程不仅可以直接访问状态，而且也无需公开私有状态，这会非常方便。")])]),t._v(" "),e("li",[e("p",[t._v("继承"),e("code",[t._v("StatefulWidget")]),t._v("不便。")]),t._v(" "),e("p",[t._v("例如，Flutter中有一个动画widget的基类"),e("code",[t._v("AnimatedWidget")]),t._v("，它继承自"),e("code",[t._v("StatefulWidget")]),t._v("类。"),e("code",[t._v("AnimatedWidget")]),t._v("中引入了一个抽象方法"),e("code",[t._v("build(BuildContext context)")]),t._v("，继承自"),e("code",[t._v("AnimatedWidget")]),t._v("的动画widget都要实现这个"),e("code",[t._v("build")]),t._v("方法。现在设想一下，如果"),e("code",[t._v("StatefulWidget")]),t._v(" 类中已经有了一个"),e("code",[t._v("build")]),t._v("方法，正如上面所述，此时"),e("code",[t._v("build")]),t._v("方法需要接收一个state对象，这就意味着"),e("code",[t._v("AnimatedWidget")]),t._v("必须将自己的State对象(记为_animatedWidgetState)提供给其子类，因为子类需要在其"),e("code",[t._v("build")]),t._v("方法中调用父类的"),e("code",[t._v("build")]),t._v("方法，代码可能如下：")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyAnimationWidget")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AnimatedWidget")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n    Widget "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BuildContext context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" State state"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//由于子类要用到AnimatedWidget的状态对象_animatedWidgetState，")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//所以AnimatedWidget必须通过某种方式将其状态对象_animatedWidgetState")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//暴露给其子类   ")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _animatedWidgetState"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("这样很显然是不合理的，因为")]),t._v(" "),e("ol",[e("li",[e("code",[t._v("AnimatedWidget")]),t._v("的状态对象是"),e("code",[t._v("AnimatedWidget")]),t._v("内部实现细节，不应该暴露给外部。")]),t._v(" "),e("li",[t._v("如果要将父类状态暴露给子类，那么必须得有一种传递机制，而做这一套传递机制是无意义的，因为父子类之间状态的传递和子类本身逻辑是无关的。")])])])]),t._v(" "),e("p",[t._v("综上所述，可以发现，对于"),e("code",[t._v("StatefulWidget")]),t._v("，将"),e("code",[t._v("build")]),t._v("方法放在State中，可以给开发带来很大的灵活性。")]),t._v(" "),e("h2",{attrs:{id:"_3-1-7-在widget树中获取state对象"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-7-在widget树中获取state对象"}},[t._v("#")]),t._v(" 3.1.7 在Widget树中获取State对象")]),t._v(" "),e("p",[t._v("由于StatefulWidget的的具体逻辑都在其State中，所以很多时候，我们需要获取StatefulWidget对应的State对象来调用一些方法，比如"),e("code",[t._v("Scaffold")]),t._v("组件对应的状态类"),e("code",[t._v("ScaffoldState")]),t._v("中就定义了打开SnackBar(路由页底部提示条)的方法。我们有两种方法在子widget树中获取父级StatefulWidget的State对象。")]),t._v(" "),e("h3",{attrs:{id:"通过context获取"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#通过context获取"}},[t._v("#")]),t._v(" 通过Context获取")]),t._v(" "),e("p",[e("code",[t._v("context")]),t._v("对象有一个"),e("code",[t._v("findAncestorStateOfType()")]),t._v("方法，该方法可以从当前节点沿着widget树向上查找指定类型的StatefulWidget对应的State对象。下面是实现打开SnackBar的示例：")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Scaffold")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  appBar"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("AppBar")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    title"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Text")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"子树中获取State对象"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  body"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Center")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    child"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Builder")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("builder"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("RaisedButton")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        onPressed"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 查找父级最近的Scaffold对应的ScaffoldState对象")]),t._v("\n          ScaffoldState _state "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("findAncestorStateOfType"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("ScaffoldState"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//调用ScaffoldState的showSnackBar来弹出SnackBar")]),t._v("\n          _state"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("showSnackBar")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("SnackBar")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n              content"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Text")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"我是SnackBar"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        child"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Text")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"显示SnackBar"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("上面示例运行后，点击”显示SnackBar“，效果如图3-1-2所示：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(603),alt:"图3-1-2"}})]),t._v(" "),e("p",[t._v("一般来说，如果StatefulWidget的状态是私有的（不应该向外部暴露），那么我们代码中就不应该去直接获取其State对象；如果StatefulWidget的状态是希望暴露出的（通常还有一些组件的操作方法），我们则可以去直接获取其State对象。但是通过"),e("code",[t._v("context.findAncestorStateOfType")]),t._v("获取StatefulWidget的状态的方法是通用的，我们并不能在语法层面指定StatefulWidget的状态是否私有，所以在Flutter开发中便有了一个默认的约定：如果StatefulWidget的状态是希望暴露出的，应当在StatefulWidget中提供一个"),e("code",[t._v("of")]),t._v("静态方法来获取其State对象，开发者便可直接通过该方法来获取；如果State不希望暴露，则不提供"),e("code",[t._v("of")]),t._v("方法。这个约定在Flutter SDK里随处可见。所以，上面示例中的"),e("code",[t._v("Scaffold")]),t._v("也提供了一个"),e("code",[t._v("of")]),t._v("方法，我们其实是可以直接调用它的：")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//省略无关代码")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 直接通过of静态方法来获取ScaffoldState ")]),t._v("\nScaffoldState _state"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Scaffold"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("of")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n_state"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("showSnackBar")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("SnackBar")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    content"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Text")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"我是SnackBar"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("h3",{attrs:{id:"通过globalkey"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#通过globalkey"}},[t._v("#")]),t._v(" 通过GlobalKey")]),t._v(" "),e("p",[t._v("Flutter还有一种通用的获取"),e("code",[t._v("State")]),t._v("对象的方法——通过GlobalKey来获取！ 步骤分两步：")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("给目标"),e("code",[t._v("StatefulWidget")]),t._v("添加"),e("code",[t._v("GlobalKey")]),t._v("。")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//定义一个globalKey, 由于GlobalKey要保持全局唯一性，我们使用静态变量存储")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" GlobalKey"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("ScaffoldState"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" _globalKey"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GlobalKey")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Scaffold")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" _globalKey "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置key")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("  \n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("通过"),e("code",[t._v("GlobalKey")]),t._v("来获取"),e("code",[t._v("State")]),t._v("对象")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[t._v("_globalKey"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("currentState"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("openDrawer")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),e("p",[t._v("GlobalKey是Flutter提供的一种在整个APP中引用element的机制。如果一个widget设置了"),e("code",[t._v("GlobalKey")]),t._v("，那么我们便可以通过"),e("code",[t._v("globalKey.currentWidget")]),t._v("获得该widget对象、"),e("code",[t._v("globalKey.currentElement")]),t._v("来获得widget对应的element对象，如果当前widget是"),e("code",[t._v("StatefulWidget")]),t._v("，则可以通过"),e("code",[t._v("globalKey.currentState")]),t._v("来获得该widget对应的state对象。")]),t._v(" "),e("blockquote",[e("p",[t._v("注意：使用GlobalKey开销较大，如果有其他可选方案，应尽量避免使用它。另外同一个GlobalKey在整个widget树中必须是唯一的，不能重复。")])]),t._v(" "),e("h2",{attrs:{id:"_3-1-8-flutter-sdk内置组件库介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-8-flutter-sdk内置组件库介绍"}},[t._v("#")]),t._v(" 3.1.8 Flutter SDK内置组件库介绍")]),t._v(" "),e("p",[t._v("Flutter提供了一套丰富、强大的基础组件，在基础组件库之上Flutter又提供了一套Material风格（Android默认的视觉风格）和一套Cupertino风格（iOS视觉风格）的组件库。要使用基础组件库，需要先导入：")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'package:flutter/widgets.dart'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("下面我们介绍一下常用的组件。")]),t._v(" "),e("h4",{attrs:{id:"基础组件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基础组件"}},[t._v("#")]),t._v(" 基础组件")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://docs.flutter.io/flutter/widgets/Text-class.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Text")]),e("OutboundLink")],1),t._v("：该组件可让您创建一个带格式的文本。")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://docs.flutter.io/flutter/widgets/Row-class.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Row")]),e("OutboundLink")],1),t._v("、 "),e("a",{attrs:{href:"https://docs.flutter.io/flutter/widgets/Column-class.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Column")]),e("OutboundLink")],1),t._v("： 这些具有弹性空间的布局类Widget可让您在水平（Row）和垂直（Column）方向上创建灵活的布局。其设计是基于Web开发中的Flexbox布局模型。")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://docs.flutter.io/flutter/widgets/Stack-class.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Stack")]),e("OutboundLink")],1),t._v("： 取代线性布局 (译者语：和Android中的"),e("code",[t._v("FrameLayout")]),t._v("相似)，"),e("a",{attrs:{href:"https://docs.flutter.io/flutter/widgets/Stack-class.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Stack")]),e("OutboundLink")],1),t._v("允许子 widget 堆叠， 你可以使用 "),e("a",{attrs:{href:"https://docs.flutter.io/flutter/widgets/Positioned-class.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Positioned")]),e("OutboundLink")],1),t._v(" 来定位他们相对于"),e("code",[t._v("Stack")]),t._v("的上下左右四条边的位置。Stacks是基于Web开发中的绝对定位（absolute positioning )布局模型设计的。")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://docs.flutter.io/flutter/widgets/Container-class.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Container")]),e("OutboundLink")],1),t._v("： "),e("a",{attrs:{href:"https://docs.flutter.io/flutter/widgets/Container-class.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Container")]),e("OutboundLink")],1),t._v(" 可让您创建矩形视觉元素。container 可以装饰一个"),e("a",{attrs:{href:"https://docs.flutter.io/flutter/painting/BoxDecoration-class.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("BoxDecoration")]),e("OutboundLink")],1),t._v(", 如 background、一个边框、或者一个阴影。 "),e("a",{attrs:{href:"https://docs.flutter.io/flutter/widgets/Container-class.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Container")]),e("OutboundLink")],1),t._v(" 也可以具有边距（margins）、填充(padding)和应用于其大小的约束(constraints)。另外， "),e("a",{attrs:{href:"https://docs.flutter.io/flutter/widgets/Container-class.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Container")]),e("OutboundLink")],1),t._v("可以使用矩阵在三维空间中对其进行变换。")])]),t._v(" "),e("h4",{attrs:{id:"material组件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#material组件"}},[t._v("#")]),t._v(" Material组件")]),t._v(" "),e("p",[t._v("Flutter提供了一套丰富的Material组件，它可以帮助我们构建遵循Material Design设计规范的应用程序。Material应用程序以"),e("a",{attrs:{href:"https://docs.flutter.io/flutter/material/MaterialApp-class.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("MaterialApp")]),e("OutboundLink")],1),t._v(" 组件开始， 该组件在应用程序的根部创建了一些必要的组件，比如"),e("code",[t._v("Theme")]),t._v("组件，它用于配置应用的主题。 是否使用"),e("a",{attrs:{href:"https://docs.flutter.io/flutter/material/MaterialApp-class.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("MaterialApp")]),e("OutboundLink")],1),t._v("完全是可选的，但是使用它是一个很好的做法。在之前的示例中，我们已经使用过多个Material 组件了，如："),e("code",[t._v("Scaffold")]),t._v("、"),e("code",[t._v("AppBar")]),t._v("、"),e("code",[t._v("FlatButton")]),t._v("等。要使用Material 组件，需要先引入它：")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'package:flutter/material.dart'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("h4",{attrs:{id:"cupertino组件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cupertino组件"}},[t._v("#")]),t._v(" Cupertino组件")]),t._v(" "),e("p",[t._v("Flutter也提供了一套丰富的Cupertino风格的组件，尽管目前还没有Material 组件那么丰富，但是它仍在不断的完善中。值得一提的是在Material 组件库中有一些组件可以根据实际运行平台来切换表现风格，比如"),e("code",[t._v("MaterialPageRoute")]),t._v("，在路由切换时，如果是Android系统，它将会使用Android系统默认的页面切换动画(从底向上)；如果是iOS系统，它会使用iOS系统默认的页面切换动画（从右向左）。由于在前面的示例中还没有Cupertino组件的示例，下面我们实现一个简单的Cupertino组件风格的页面：")]),t._v(" "),e("div",{staticClass:"language-dart extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dart"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//导入cupertino widget库")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'package:flutter/cupertino.dart'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CupertinoTestRoute")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StatelessWidget")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token metadata symbol"}},[t._v("@override")]),t._v("\n  Widget "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BuildContext context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CupertinoPageScaffold")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      navigationBar"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CupertinoNavigationBar")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        middle"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Text")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Cupertino Demo"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      child"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Center")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        child"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CupertinoButton")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            color"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CupertinoColors"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("activeBlue"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            child"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Text")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Press"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            onPressed"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("下面（图3-3）是在iPhoneX上页面效果截图：")]),t._v(" "),e("p",[e("img",{attrs:{src:s(604),alt:"图3-3"}})]),t._v(" "),e("h3",{attrs:{id:"关于示例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关于示例"}},[t._v("#")]),t._v(" 关于示例")]),t._v(" "),e("p",[t._v("本章后面章节的示例中会使用一些布局类组件，如"),e("code",[t._v("Scaffold")]),t._v("、"),e("code",[t._v("Row")]),t._v("、"),e("code",[t._v("Column")]),t._v("等，这些组件将在后面“布局类组件”一章中详细介绍，读者可以先不用关注。")]),t._v(" "),e("h3",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),e("p",[t._v("Flutter提供了丰富的组件，在实际的开发中你可以根据需要随意使用它们，而不必担心引入过多组件库会让你的应用安装包变大，这不是web开发，dart在编译时只会编译你使用了的代码。由于Material和Cupertino都是在基础组件库之上的，所以如果我们的应用中引入了这两者之一，则不需要再引入"),e("code",[t._v("flutter/widgets.dart")]),t._v("了，因为它们内部已经引入过了。")])])}),[],!1,null,null,null);a.default=n.exports}}]);