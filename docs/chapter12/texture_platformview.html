<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>12.6 Texture和PlatformView | 《Flutter实战》电子书</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.c0f2585a.css" as="style"><link rel="preload" href="/assets/js/app.b60cbd9e.js" as="script"><link rel="preload" href="/assets/js/21.70d8a941.js" as="script"><link rel="preload" href="/assets/js/2.fb4ba5aa.js" as="script"><link rel="preload" href="/assets/js/35.d79277d5.js" as="script"><link rel="prefetch" href="/assets/js/10.64c8327a.js"><link rel="prefetch" href="/assets/js/100.960f7f17.js"><link rel="prefetch" href="/assets/js/101.5f34d584.js"><link rel="prefetch" href="/assets/js/102.cd093510.js"><link rel="prefetch" href="/assets/js/103.54624896.js"><link rel="prefetch" href="/assets/js/104.77eac47f.js"><link rel="prefetch" href="/assets/js/105.65c69c7e.js"><link rel="prefetch" href="/assets/js/106.1b04ade8.js"><link rel="prefetch" href="/assets/js/107.df3f2e89.js"><link rel="prefetch" href="/assets/js/108.f87afe51.js"><link rel="prefetch" href="/assets/js/109.5e858a61.js"><link rel="prefetch" href="/assets/js/11.18b61e27.js"><link rel="prefetch" href="/assets/js/110.4924d4f0.js"><link rel="prefetch" href="/assets/js/111.6848f4e5.js"><link rel="prefetch" href="/assets/js/112.b7c1be33.js"><link rel="prefetch" href="/assets/js/113.b79b28c6.js"><link rel="prefetch" href="/assets/js/114.6bdb7230.js"><link rel="prefetch" href="/assets/js/115.25428749.js"><link rel="prefetch" href="/assets/js/116.cccf75da.js"><link rel="prefetch" href="/assets/js/117.67802690.js"><link rel="prefetch" href="/assets/js/118.e6015f3c.js"><link rel="prefetch" href="/assets/js/12.d26fec67.js"><link rel="prefetch" href="/assets/js/13.f49676ab.js"><link rel="prefetch" href="/assets/js/14.7e782bf4.js"><link rel="prefetch" href="/assets/js/15.7eaf3a89.js"><link rel="prefetch" href="/assets/js/16.dfea62bd.js"><link rel="prefetch" href="/assets/js/17.1e68d5d4.js"><link rel="prefetch" href="/assets/js/18.4c497a69.js"><link rel="prefetch" href="/assets/js/19.b2bfd3a9.js"><link rel="prefetch" href="/assets/js/20.262f07a9.js"><link rel="prefetch" href="/assets/js/22.16bda49c.js"><link rel="prefetch" href="/assets/js/23.f7333f23.js"><link rel="prefetch" href="/assets/js/24.771ff499.js"><link rel="prefetch" href="/assets/js/25.6d58cdb1.js"><link rel="prefetch" href="/assets/js/26.d073dbdd.js"><link rel="prefetch" href="/assets/js/27.dad783f9.js"><link rel="prefetch" href="/assets/js/28.d8f950ad.js"><link rel="prefetch" href="/assets/js/29.0055bf49.js"><link rel="prefetch" href="/assets/js/3.266b01d1.js"><link rel="prefetch" href="/assets/js/30.4ed156b3.js"><link rel="prefetch" href="/assets/js/31.93084f0b.js"><link rel="prefetch" href="/assets/js/32.0f04e72f.js"><link rel="prefetch" href="/assets/js/33.5bc7a3e8.js"><link rel="prefetch" href="/assets/js/34.0383a067.js"><link rel="prefetch" href="/assets/js/36.ea2a774a.js"><link rel="prefetch" href="/assets/js/37.f48b378a.js"><link rel="prefetch" href="/assets/js/38.760872e6.js"><link rel="prefetch" href="/assets/js/39.4452ef7d.js"><link rel="prefetch" href="/assets/js/4.de971fcc.js"><link rel="prefetch" href="/assets/js/40.0464609b.js"><link rel="prefetch" href="/assets/js/41.9cda20ad.js"><link rel="prefetch" href="/assets/js/42.de02cf53.js"><link rel="prefetch" href="/assets/js/43.63d8b174.js"><link rel="prefetch" href="/assets/js/44.857326af.js"><link rel="prefetch" href="/assets/js/45.eadede9f.js"><link rel="prefetch" href="/assets/js/46.56182597.js"><link rel="prefetch" href="/assets/js/47.d4b29d82.js"><link rel="prefetch" href="/assets/js/48.c427c57e.js"><link rel="prefetch" href="/assets/js/49.bfdbb114.js"><link rel="prefetch" href="/assets/js/5.008bcb93.js"><link rel="prefetch" href="/assets/js/50.6a8f69cc.js"><link rel="prefetch" href="/assets/js/51.2b1f7023.js"><link rel="prefetch" href="/assets/js/52.07c4e6b7.js"><link rel="prefetch" href="/assets/js/53.1720618a.js"><link rel="prefetch" href="/assets/js/54.58cd5dab.js"><link rel="prefetch" href="/assets/js/55.7361edcb.js"><link rel="prefetch" href="/assets/js/56.86dc3bf5.js"><link rel="prefetch" href="/assets/js/57.a7ece16c.js"><link rel="prefetch" href="/assets/js/58.77b26309.js"><link rel="prefetch" href="/assets/js/59.967b4fdb.js"><link rel="prefetch" href="/assets/js/6.2ca5ded8.js"><link rel="prefetch" href="/assets/js/60.4b2dc6bb.js"><link rel="prefetch" href="/assets/js/61.1ad6f499.js"><link rel="prefetch" href="/assets/js/62.4215116c.js"><link rel="prefetch" href="/assets/js/63.22af22b1.js"><link rel="prefetch" href="/assets/js/64.6e3e97f3.js"><link rel="prefetch" href="/assets/js/65.40c8ed0d.js"><link rel="prefetch" href="/assets/js/66.de299683.js"><link rel="prefetch" href="/assets/js/67.e0b99744.js"><link rel="prefetch" href="/assets/js/68.810f0503.js"><link rel="prefetch" href="/assets/js/69.76564e0f.js"><link rel="prefetch" href="/assets/js/7.da17077a.js"><link rel="prefetch" href="/assets/js/70.3ffae14e.js"><link rel="prefetch" href="/assets/js/71.a285e32b.js"><link rel="prefetch" href="/assets/js/72.a9bd2c05.js"><link rel="prefetch" href="/assets/js/73.d7dce152.js"><link rel="prefetch" href="/assets/js/74.4c3b3bef.js"><link rel="prefetch" href="/assets/js/75.5d8d77be.js"><link rel="prefetch" href="/assets/js/76.e7dc1070.js"><link rel="prefetch" href="/assets/js/77.8d723515.js"><link rel="prefetch" href="/assets/js/78.f358d705.js"><link rel="prefetch" href="/assets/js/79.a1e01ec8.js"><link rel="prefetch" href="/assets/js/8.a048a60a.js"><link rel="prefetch" href="/assets/js/80.18a49304.js"><link rel="prefetch" href="/assets/js/81.d73d0f93.js"><link rel="prefetch" href="/assets/js/82.c804bff9.js"><link rel="prefetch" href="/assets/js/83.5a85879a.js"><link rel="prefetch" href="/assets/js/84.0272ce23.js"><link rel="prefetch" href="/assets/js/85.da876eef.js"><link rel="prefetch" href="/assets/js/86.0b9386d7.js"><link rel="prefetch" href="/assets/js/87.07f2efae.js"><link rel="prefetch" href="/assets/js/88.d56b7351.js"><link rel="prefetch" href="/assets/js/89.378a4c52.js"><link rel="prefetch" href="/assets/js/9.dd38c563.js"><link rel="prefetch" href="/assets/js/90.53fffae6.js"><link rel="prefetch" href="/assets/js/91.21c83b2f.js"><link rel="prefetch" href="/assets/js/92.ce78b670.js"><link rel="prefetch" href="/assets/js/93.c2ccba3f.js"><link rel="prefetch" href="/assets/js/94.4b363af2.js"><link rel="prefetch" href="/assets/js/95.868a7e3a.js"><link rel="prefetch" href="/assets/js/96.219efea2.js"><link rel="prefetch" href="/assets/js/97.a0856ea2.js"><link rel="prefetch" href="/assets/js/98.1709a69a.js"><link rel="prefetch" href="/assets/js/99.020a0566.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c0f2585a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">《Flutter实战》电子书</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/join_us.html" class="nav-link">
  和作者做同事
</a></div><div class="nav-item"><a href="https://github.com/flutterchina" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Flutter中国
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/flutterchina/flutter-in-action" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://item.jd.com/12816296.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  实体书
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/join_us.html" class="nav-link">
  和作者做同事
</a></div><div class="nav-item"><a href="https://github.com/flutterchina" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Flutter中国
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/flutterchina/flutter-in-action" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://item.jd.com/12816296.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  实体书
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">首页</a></li><li><section class="sidebar-group depth-0"><a href="/chapter1/index" class="sidebar-heading clickable"><span>第一章：起步</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter1/mobile_development_intro.html" class="sidebar-link">1.1 移动开发技术简介</a></li><li><a href="/chapter1/flutter_intro.html" class="sidebar-link">1.2 初识Flutter</a></li><li><a href="/chapter1/install_flutter.html" class="sidebar-link">1.3 搭建Flutter开发环境</a></li><li><a href="/chapter1/dart.html" class="sidebar-link">1.4 Dart语言简介</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter2/index" class="sidebar-heading clickable"><span>第二章：第一个Flutter应用</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter2/first_flutter_app.html" class="sidebar-link">2.1 计数器应用示例</a></li><li><a href="/chapter2/flutter_router.html" class="sidebar-link">2.2 路由管理</a></li><li><a href="/chapter2/flutter_package_mgr.html" class="sidebar-link">2.3 包管理</a></li><li><a href="/chapter2/flutter_assets_mgr.html" class="sidebar-link">2.4 资源管理</a></li><li><a href="/chapter2/flutter_app_debug.html" class="sidebar-link">2.5 调试Flutter应用</a></li><li><a href="/chapter2/thread_model_and_error_report.html" class="sidebar-link">2.6 Flutter异常捕获</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter3/index" class="sidebar-heading clickable"><span>第三章：基础组件</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter3/flutter_widget_intro.html" class="sidebar-link">3.1 Widget简介</a></li><li><a href="/chapter3/state_manage.html" class="sidebar-link">3.2 状态管理</a></li><li><a href="/chapter3/text.html" class="sidebar-link">3.3 文本及样式</a></li><li><a href="/chapter3/buttons.html" class="sidebar-link">3.4 按钮</a></li><li><a href="/chapter3/img_and_icon.html" class="sidebar-link">3.5 图片及ICON</a></li><li><a href="/chapter3/radio_and_checkbox.html" class="sidebar-link">3.6 单选开关和复选框</a></li><li><a href="/chapter3/input_and_form.html" class="sidebar-link">3.7 输入框及表单</a></li><li><a href="/chapter3/progress.html" class="sidebar-link">3.8 进度指示器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter12/chapter4/index.md" class="sidebar-heading clickable"><span>第四章：布局类组件</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter4/intro.html" class="sidebar-link">4.1 布局类组件简介</a></li><li><a href="/chapter4/row_and_column.html" class="sidebar-link">4.2 线性布局（Row和Column）</a></li><li><a href="/chapter4/flex.html" class="sidebar-link">4.3 弹性布局（Flex）</a></li><li><a href="/chapter4/wrap_and_flow.html" class="sidebar-link">4.4 流式布局</a></li><li><a href="/chapter4/stack.html" class="sidebar-link">4.5 层叠布局 Stack、Positioned</a></li><li><a href="/chapter4/alignment.html" class="sidebar-link">4.6 对齐与相对定位（Align）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter5/index" class="sidebar-heading clickable"><span>第五章：容器类组件</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter5/padding.html" class="sidebar-link">5.1 填充（Padding）</a></li><li><a href="/chapter5/constrainedbox_and_sizebox.html" class="sidebar-link">5.2 尺寸限制类容器</a></li><li><a href="/chapter5/decoratedbox.html" class="sidebar-link">5.3 装饰容器DecoratedBox</a></li><li><a href="/chapter5/transform.html" class="sidebar-link">5.4 变换（Transform）</a></li><li><a href="/chapter5/container.html" class="sidebar-link">5.5 Container</a></li><li><a href="/chapter5/material_scaffold.html" class="sidebar-link">5.6 Scaffold、TabBar、底部导航</a></li><li><a href="/chapter5/clip.html" class="sidebar-link">5.7 剪裁（Clip）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter6/index" class="sidebar-heading clickable"><span>第六章：可滚动组件</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter6/intro.html" class="sidebar-link">6.1 可滚动组件简介</a></li><li><a href="/chapter6/single_child_scrollview.html" class="sidebar-link">6.2 SingleChildScrollView</a></li><li><a href="/chapter6/listview.html" class="sidebar-link">6.3 ListView</a></li><li><a href="/chapter6/gridview.html" class="sidebar-link">6.4 GridView</a></li><li><a href="/chapter6/custom_scrollview.html" class="sidebar-link">6.5 CustomScrollView</a></li><li><a href="/chapter6/scroll_controller.html" class="sidebar-link">6.6 滚动监听及控制</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter7/index" class="sidebar-heading clickable"><span>第七章：功能型组件</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter7/willpopscope.html" class="sidebar-link">7.1 导航返回拦截（WillPopScope）</a></li><li><a href="/chapter7/inherited_widget.html" class="sidebar-link">7.2 数据共享（InheritedWidget）</a></li><li><a href="/chapter7/provider.html" class="sidebar-link">7.3 跨组件状态共享（Provider）</a></li><li><a href="/chapter7/theme.html" class="sidebar-link">7.4 颜色和主题</a></li><li><a href="/chapter7/futurebuilder_and_streambuilder.html" class="sidebar-link">7.5 异步UI更新（FutureBuilder、StreamBuilder）</a></li><li><a href="/chapter7/dailog.html" class="sidebar-link">7.6 对话框详解</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter8/index" class="sidebar-heading clickable"><span>第八章：事件处理与通知</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter8/listener.html" class="sidebar-link">8.1 原始指针事件处理</a></li><li><a href="/chapter8/gesture.html" class="sidebar-link">8.2 手势识别</a></li><li><a href="/chapter8/eventbus.html" class="sidebar-link">8.3 事件总线</a></li><li><a href="/chapter8/notification.html" class="sidebar-link">8.4 Notification</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter9/index" class="sidebar-heading clickable"><span>第九章：动画</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter9/intro.html" class="sidebar-link">9.1 Flutter动画简介</a></li><li><a href="/chapter9/animation_structure.html" class="sidebar-link">9.2 动画基本结构及状态监听</a></li><li><a href="/chapter9/route_transition.html" class="sidebar-link">9.3 自定义路由切换动画</a></li><li><a href="/chapter9/hero.html" class="sidebar-link">9.4 Hero动画</a></li><li><a href="/chapter9/stagger_animation.html" class="sidebar-link">9.5 交织动画</a></li><li><a href="/chapter9/animated_switcher.html" class="sidebar-link">9.6 通用“动画切换”组件（AnimatedSwitcher）</a></li><li><a href="/chapter9/animated_widgets.html" class="sidebar-link">9.7 动画过渡组件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter10/index" class="sidebar-heading clickable"><span>第十章：自定义组件</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter10/intro.html" class="sidebar-link">10.1 自定义组件方法简介</a></li><li><a href="/chapter10/combine.html" class="sidebar-link">10.2 组合现有组件</a></li><li><a href="/chapter10/turn_box.html" class="sidebar-link">10.3 组合实例：TurnBox</a></li><li><a href="/chapter10/custom_paint.html" class="sidebar-link">10.4 自绘组件 （CustomPaint与Canvas）</a></li><li><a href="/chapter10/gradient_circular_progress_demo.html" class="sidebar-link">10.5 自绘实例：圆形背景渐变进度条</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter11/index" class="sidebar-heading clickable"><span>第十一章：文件操作与网络请求</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter11/file_operation.html" class="sidebar-link">11.1 文件操作</a></li><li><a href="/chapter11/http.html" class="sidebar-link">11.2 通过HttpClient发起HTTP请求</a></li><li><a href="/chapter11/dio.html" class="sidebar-link">11.3 Http请求-Dio http库</a></li><li><a href="/chapter11/download_with_chunks.html" class="sidebar-link">11.4 实例：Http分块下载</a></li><li><a href="/chapter11/websocket.html" class="sidebar-link">使用WebSockets</a></li><li><a href="/chapter11/socket.html" class="sidebar-link">11.6 使用Socket API</a></li><li><a href="/chapter11/json_model.html" class="sidebar-link">11.7 Json转Dart Model类</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter12/index" class="sidebar-heading clickable open"><span>第十二章：包与插件</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter12/develop_package.html" class="sidebar-link">12.1 开发Package</a></li><li><a href="/chapter12/platform-channel.html" class="sidebar-link">12.2 插件开发：平台通道简介</a></li><li><a href="/chapter12/develop_plugin.html" class="sidebar-link">12.3 开发Flutter插件</a></li><li><a href="/chapter12/android_implement.html" class="sidebar-link">12.4 插件开发：Android端API实现</a></li><li><a href="/chapter12/ios_implement.html" class="sidebar-link">12.5 插件开发：iOS端API实现</a></li><li><a href="/chapter12/texture_platformview.html" aria-current="page" class="active sidebar-link">12.6 Texture和PlatformView</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapter12/texture_platformview.html#_12-6-1-texture-示例-使用摄像头" class="sidebar-link">12.6.1 Texture（示例：使用摄像头）</a></li><li class="sidebar-sub-header"><a href="/chapter12/texture_platformview.html#_12-6-2-platformview-示例-webview" class="sidebar-link">12.6.2 PlatformView （示例：WebView）</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter13/index" class="sidebar-heading clickable"><span>第十三章：国际化</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter13/multi_languages_support.html" class="sidebar-link">13.1 让App支持多语言</a></li><li><a href="/chapter13/locallization_implement.html" class="sidebar-link">13.2 实现Localizations</a></li><li><a href="/chapter13/intl.html" class="sidebar-link">使用Intl包</a></li><li><a href="/chapter13/faq.html" class="sidebar-link">13.4 国际化常见问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter14/index" class="sidebar-heading clickable"><span>第十四章：Flutter核心原理</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter14/flutter_ui_system.html" class="sidebar-link">14.1 Flutter UI系统</a></li><li><a href="/chapter14/element_buildcontext.html" class="sidebar-link">14.2 Element与BuildContext</a></li><li><a href="/chapter14/render_object.html" class="sidebar-link">14.3 RenderObject和RenderBox</a></li><li><a href="/chapter14/flutter_app_startup.html" class="sidebar-link">14.4 Flutter运行机制-从启动到显示</a></li><li><a href="/chapter14/image_and_cache.html" class="sidebar-link">14.5 图片加载原理与缓存</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第十五章：一个完整的Flutter应用</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter15/intro.html" class="sidebar-link">15.1 Github客户端示例</a></li><li><a href="/chapter15/code_structure.html" class="sidebar-link">15.2 Flutter APP代码结构</a></li><li><a href="/chapter15/models.html" class="sidebar-link">15.3 Model类定义</a></li><li><a href="/chapter15/globals.html" class="sidebar-link">15.4 全局变量及共享状态</a></li><li><a href="/chapter15/network.html" class="sidebar-link">15.5 网络请求封装</a></li><li><a href="/chapter15/entry.html" class="sidebar-link">15.6 APP入口及主页</a></li><li><a href="/chapter15/login_page.html" class="sidebar-link">15.7 登录页</a></li><li><a href="/chapter15/language_and_theme_setting.html" class="sidebar-link">15.8 多语言和多主题</a></li></ul></section></li></ul> </aside> <main class="page"> <!----> <div class="theme-default-content content__default"><h1 id="_12-6-texture和platformview"><a href="#_12-6-texture和platformview" class="header-anchor">#</a> 12.6 Texture和PlatformView</h1> <p>本节主要介绍原生和Flutter之间如何共享图像，以及如何在Flutter中嵌套原生组件。</p> <h2 id="_12-6-1-texture-示例-使用摄像头"><a href="#_12-6-1-texture-示例-使用摄像头" class="header-anchor">#</a> 12.6.1 Texture（示例：使用摄像头）</h2> <p>前面说过Flutter本身只是一个UI系统，对于一些系统能力的调用我们可以通过消息传送机制与原生交互。但是这种消息传送机制并不能覆盖所有的应用场景，比如我们想调用摄像头来拍照或录视频，但在拍照和录视频的过程中我们需要将预览画面显示到我们的Flutter UI中，如果我们要用Flutter定义的消息通道机制来实现这个功能，就需要将摄像头采集的每一帧图片都要从原生传递到Flutter中，这样做代价将会非常大，因为将图像或视频数据通过消息通道实时传输必然会引起内存和CPU的巨大消耗！为此，Flutter提供了一种基于Texture的图片数据共享机制。</p> <p>Texture可以理解为GPU内保存将要绘制的图像数据的一个对象，Flutter engine会将Texture的数据在内存中直接进行映射（而无需在原生和Flutter之间再进行数据传递），Flutter会给每一个Texture分配一个id，同时Flutter中提供了一个<code>Texture</code>组件，<code>Texture</code>构造函数定义如下：</p> <div class="language-dart extra-class"><pre class="language-dart"><code><span class="token keyword">const</span> <span class="token function">Texture</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  Key key<span class="token punctuation">,</span>
  <span class="token metadata symbol">@required</span> <span class="token keyword">this</span><span class="token punctuation">.</span>textureId<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>Texture</code> 组件正是通过<code>textureId</code>与Texture数据关联起来；在<code>Texture</code>组件绘制时，Flutter会自动从内存中找到相应id的Texture数据，然后进行绘制。可以总结一下整个流程：图像数据先在原生部分缓存，然后在Flutter部分再通过<code>textureId</code>和缓存关联起来，最后绘制由Flutter完成。</p> <p>如果我们作为一个插件开发者，我们在原生代码中分配了<code>textureId</code>，那么在Flutter侧使用<code>Texture</code>组件时要如何获取<code>textureId</code>呢？这又回到了之前的内容了，<code>textureId</code>完全可以通过MethodChannel来传递。</p> <p>另外，值得注意的是，当原生摄像头捕获的图像发生变化时，<code>Texture</code> 组件会自动重绘，这不需要我们写任何Dart 代码去控制。</p> <h3 id="texture用法"><a href="#texture用法" class="header-anchor">#</a> Texture用法</h3> <p>如果我们要手动实现一个相机插件，和前面几节介绍的“获取剩余电量”插件的步骤一样，需要分别实现原生部分和Flutter部分。考虑到大多数读者可能并非同时既了解Android开发，又了解iOS开发，如果我们再花大量篇幅来介绍不同端的实现可能会没什么意义，另外，由于Flutter官方提供的相机（camera）插件和视频播放（video_player）插件都是使用Texture来实现的，它们本身就是Texture非常好的示例，所以在本书中将不会再介绍使用Texture的具体流程了，读者有兴趣查看camera和video_player的实现代码。下面我们重点介绍一下如何使用camera和video_player。</p> <h3 id="相机示例"><a href="#相机示例" class="header-anchor">#</a> 相机示例</h3> <p>下面我们看一下camera包自带的一个示例，它包含如下功能：</p> <ol><li>可以拍照，也可以拍视频，拍摄完成后可以保存；排号的视频可以播放预览。</li> <li>可以切换摄像头（前置摄像头、后置摄像头、其它）</li> <li>可以显示已经拍摄内容的预览图。</li></ol> <p>下面我们看一下具体代码：</p> <ol><li><p>首先，依赖camera插件的最新版，并下载依赖。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">dependencies</span><span class="token punctuation">:</span>
  <span class="token punctuation">...</span>  //省略无关代码
  <span class="token key atrule">camera</span><span class="token punctuation">:</span> ^0.5.2+2
</code></pre></div></li> <li><p>在<code>main</code>方法中获取可用摄像头列表。</p> <div class="language-dart extra-class"><pre class="language-dart"><code><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取可用摄像头列表，cameras为全局变量</span>
  cameras <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">availableCameras</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>构建UI。现在我们构建如图12-4的测试界面：</p> <p><img src="/assets/img/12-4.49c3c9bf.jpg" alt="12-4">
线面是完整的代码：</p> <div class="language-dart extra-class"><pre class="language-dart"><code><span class="token keyword">import</span> <span class="token string">'package:camera/camera.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'../common.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'dart:async'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'dart:io'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:path_provider/path_provider.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:video_player/video_player.dart'</span><span class="token punctuation">;</span> <span class="token comment">//用于播放录制的视频</span>

<span class="token comment">/// 获取不同摄像头的图标（前置、后置、其它）</span>
IconData <span class="token function">getCameraLensIcon</span><span class="token punctuation">(</span>CameraLensDirection direction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>direction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> CameraLensDirection<span class="token punctuation">.</span>back<span class="token punctuation">:</span>
      <span class="token keyword">return</span> Icons<span class="token punctuation">.</span>camera_rear<span class="token punctuation">;</span>
    <span class="token keyword">case</span> CameraLensDirection<span class="token punctuation">.</span>front<span class="token punctuation">:</span>
      <span class="token keyword">return</span> Icons<span class="token punctuation">.</span>camera_front<span class="token punctuation">;</span>
    <span class="token keyword">case</span> CameraLensDirection<span class="token punctuation">.</span><span class="token keyword">external</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> Icons<span class="token punctuation">.</span>camera<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">throw</span> <span class="token function">ArgumentError</span><span class="token punctuation">(</span><span class="token string">'Unknown lens direction'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">logError</span><span class="token punctuation">(</span>String code<span class="token punctuation">,</span> String message<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Error: $code\nError Message: $message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 示例页面路由</span>
<span class="token keyword">class</span> <span class="token class-name">CameraExampleHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  _CameraExampleHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">_CameraExampleHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_CameraExampleHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>CameraExampleHome<span class="token operator">&gt;</span>
    <span class="token keyword">with</span> WidgetsBindingObserver <span class="token punctuation">{</span>
  CameraController controller<span class="token punctuation">;</span>
  String imagePath<span class="token punctuation">;</span> <span class="token comment">// 图片保存路径</span>
  String videoPath<span class="token punctuation">;</span> <span class="token comment">//视频保存路径</span>
  VideoPlayerController videoController<span class="token punctuation">;</span>
  VoidCallback videoPlayerListener<span class="token punctuation">;</span>
  bool enableAudio <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 监听APP状态改变，是否在前台</span>
    WidgetsBinding<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    WidgetsBinding<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">removeObserver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">didChangeAppLifecycleState</span><span class="token punctuation">(</span>AppLifecycleState state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果APP不在在前台</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> AppLifecycleState<span class="token punctuation">.</span>inactive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      controller<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> AppLifecycleState<span class="token punctuation">.</span>resumed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 在前台</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>controller <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">onNewCameraSelected</span><span class="token punctuation">(</span>controller<span class="token punctuation">.</span>description<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">final</span> GlobalKey<span class="token operator">&lt;</span>ScaffoldState<span class="token operator">&gt;</span> _scaffoldKey <span class="token operator">=</span> GlobalKey<span class="token operator">&lt;</span>ScaffoldState<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      key<span class="token punctuation">:</span> _scaffoldKey<span class="token punctuation">,</span>
      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
        title<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'相机示例'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      body<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>
          <span class="token function">Expanded</span><span class="token punctuation">(</span>
            child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
              child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>
                padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>
                  child<span class="token punctuation">:</span> <span class="token function">_cameraPreviewWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
                color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>
                border<span class="token punctuation">:</span> Border<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
                  color<span class="token punctuation">:</span> controller <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> controller<span class="token punctuation">.</span>value<span class="token punctuation">.</span>isRecordingVideo
                      <span class="token operator">?</span> Colors<span class="token punctuation">.</span>redAccent
                      <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>
                  width<span class="token punctuation">:</span> <span class="token number">3.0</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">_captureControlRowWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">_toggleAudioWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">Padding</span><span class="token punctuation">(</span>
            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
              mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>
              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>
                <span class="token function">_cameraTogglesRowWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">_thumbnailWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// 展示预览窗口</span>
  Widget <span class="token function">_cameraPreviewWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>controller <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>controller<span class="token punctuation">.</span>value<span class="token punctuation">.</span>isInitialized<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span>
        <span class="token string">'选择一个摄像头'</span><span class="token punctuation">,</span>
        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>
          fontSize<span class="token punctuation">:</span> <span class="token number">24.0</span><span class="token punctuation">,</span>
          fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w900<span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">AspectRatio</span><span class="token punctuation">(</span>
        aspectRatio<span class="token punctuation">:</span> controller<span class="token punctuation">.</span>value<span class="token punctuation">.</span>aspectRatio<span class="token punctuation">,</span>
        child<span class="token punctuation">:</span> <span class="token function">CameraPreview</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// 开启或关闭录音</span>
  Widget <span class="token function">_toggleAudioWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Padding</span><span class="token punctuation">(</span>
      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>
          <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'开启录音:'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">Switch</span><span class="token punctuation">(</span>
            value<span class="token punctuation">:</span> enableAudio<span class="token punctuation">,</span>
            onChanged<span class="token punctuation">:</span> <span class="token punctuation">(</span>bool value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              enableAudio <span class="token operator">=</span> value<span class="token punctuation">;</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>controller <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">onNewCameraSelected</span><span class="token punctuation">(</span>controller<span class="token punctuation">.</span>description<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// 显示已拍摄的图片/视频缩略图。</span>
  Widget <span class="token function">_thumbnailWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Expanded</span><span class="token punctuation">(</span>
      child<span class="token punctuation">:</span> <span class="token function">Align</span><span class="token punctuation">(</span>
        alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>centerRight<span class="token punctuation">,</span>
        child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
          mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>min<span class="token punctuation">,</span>
          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>
            videoController <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> imagePath <span class="token operator">==</span> <span class="token keyword">null</span>
                <span class="token operator">?</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">:</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>
              child<span class="token punctuation">:</span> <span class="token punctuation">(</span>videoController <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                  <span class="token operator">?</span> Image<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token function">File</span><span class="token punctuation">(</span>imagePath<span class="token punctuation">)</span><span class="token punctuation">)</span>
                  <span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>
                  child<span class="token punctuation">:</span> <span class="token function">AspectRatio</span><span class="token punctuation">(</span>
                      aspectRatio<span class="token punctuation">:</span>
                      videoController<span class="token punctuation">.</span>value<span class="token punctuation">.</span>size <span class="token operator">!=</span> <span class="token keyword">null</span>
                          <span class="token operator">?</span> videoController<span class="token punctuation">.</span>value<span class="token punctuation">.</span>aspectRatio
                          <span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
                      child<span class="token punctuation">:</span> <span class="token function">VideoPlayer</span><span class="token punctuation">(</span>videoController<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
                    border<span class="token punctuation">:</span> Border<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              width<span class="token punctuation">:</span> <span class="token number">64.0</span><span class="token punctuation">,</span>
              height<span class="token punctuation">:</span> <span class="token number">64.0</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// 相机工具栏</span>
  Widget <span class="token function">_captureControlRowWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Row</span><span class="token punctuation">(</span>
      mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span>
      mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>max<span class="token punctuation">,</span>
      children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>
        <span class="token function">IconButton</span><span class="token punctuation">(</span>
          icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>camera_alt<span class="token punctuation">)</span><span class="token punctuation">,</span>
          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>
          onPressed<span class="token punctuation">:</span> controller <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
              controller<span class="token punctuation">.</span>value<span class="token punctuation">.</span>isInitialized <span class="token operator">&amp;&amp;</span>
              <span class="token operator">!</span>controller<span class="token punctuation">.</span>value<span class="token punctuation">.</span>isRecordingVideo
              <span class="token operator">?</span> onTakePictureButtonPressed
              <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">IconButton</span><span class="token punctuation">(</span>
          icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>videocam<span class="token punctuation">)</span><span class="token punctuation">,</span>
          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>
          onPressed<span class="token punctuation">:</span> controller <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
              controller<span class="token punctuation">.</span>value<span class="token punctuation">.</span>isInitialized <span class="token operator">&amp;&amp;</span>
              <span class="token operator">!</span>controller<span class="token punctuation">.</span>value<span class="token punctuation">.</span>isRecordingVideo
              <span class="token operator">?</span> onVideoRecordButtonPressed
              <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">IconButton</span><span class="token punctuation">(</span>
          icon<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>stop<span class="token punctuation">)</span><span class="token punctuation">,</span>
          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">,</span>
          onPressed<span class="token punctuation">:</span> controller <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
              controller<span class="token punctuation">.</span>value<span class="token punctuation">.</span>isInitialized <span class="token operator">&amp;&amp;</span>
              controller<span class="token punctuation">.</span>value<span class="token punctuation">.</span>isRecordingVideo
              <span class="token operator">?</span> onStopButtonPressed
              <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// 展示所有摄像头</span>
  Widget <span class="token function">_cameraTogglesRowWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> List<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span> toggles <span class="token operator">=</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>cameras<span class="token punctuation">.</span>isEmpty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">const</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'没有检测到摄像头'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>CameraDescription cameraDescription <span class="token keyword">in</span> cameras<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        toggles<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
          <span class="token function">SizedBox</span><span class="token punctuation">(</span>
            width<span class="token punctuation">:</span> <span class="token number">90.0</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> RadioListTile<span class="token operator">&lt;</span>CameraDescription<span class="token operator">&gt;</span><span class="token punctuation">(</span>
              title<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span><span class="token function">getCameraLensIcon</span><span class="token punctuation">(</span>cameraDescription<span class="token punctuation">.</span>lensDirection<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              groupValue<span class="token punctuation">:</span> controller<span class="token operator">?</span><span class="token punctuation">.</span>description<span class="token punctuation">,</span>
              value<span class="token punctuation">:</span> cameraDescription<span class="token punctuation">,</span>
              onChanged<span class="token punctuation">:</span> controller <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> controller<span class="token punctuation">.</span>value<span class="token punctuation">.</span>isRecordingVideo
                  <span class="token operator">?</span> <span class="token keyword">null</span>
                  <span class="token punctuation">:</span> onNewCameraSelected<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token function">Row</span><span class="token punctuation">(</span>children<span class="token punctuation">:</span> toggles<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  String <span class="token function">timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> DateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>millisecondsSinceEpoch<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token function">showInSnackBar</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _scaffoldKey<span class="token punctuation">.</span>currentState<span class="token punctuation">.</span><span class="token function">showSnackBar</span><span class="token punctuation">(</span><span class="token function">SnackBar</span><span class="token punctuation">(</span>content<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 摄像头选中回调</span>
  <span class="token keyword">void</span> <span class="token function">onNewCameraSelected</span><span class="token punctuation">(</span>CameraDescription cameraDescription<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>controller <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> controller<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    controller <span class="token operator">=</span> <span class="token function">CameraController</span><span class="token punctuation">(</span>
      cameraDescription<span class="token punctuation">,</span>
      ResolutionPreset<span class="token punctuation">.</span>high<span class="token punctuation">,</span>
      enableAudio<span class="token punctuation">:</span> enableAudio<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    controller<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>mounted<span class="token punctuation">)</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>controller<span class="token punctuation">.</span>value<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">showInSnackBar</span><span class="token punctuation">(</span><span class="token string">'Camera error ${controller.value.errorDescription}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> controller<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">on</span> CameraException <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">_showCameraException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>mounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 拍照按钮点击回调</span>
  <span class="token keyword">void</span> <span class="token function">onTakePictureButtonPressed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">takePicture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>String filePath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>mounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          imagePath <span class="token operator">=</span> filePath<span class="token punctuation">;</span>
          videoController<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          videoController <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>filePath <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token function">showInSnackBar</span><span class="token punctuation">(</span><span class="token string">'图片保存在 $filePath'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 开始录制视频</span>
  <span class="token keyword">void</span> <span class="token function">onVideoRecordButtonPressed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">startVideoRecording</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>String filePath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>mounted<span class="token punctuation">)</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>filePath <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token function">showInSnackBar</span><span class="token punctuation">(</span><span class="token string">'正在保存视频于 $filePath'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 终止视频录制</span>
  <span class="token keyword">void</span> <span class="token function">onStopButtonPressed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">stopVideoRecording</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>mounted<span class="token punctuation">)</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">showInSnackBar</span><span class="token punctuation">(</span><span class="token string">'视频保存在: $videoPath'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  Future<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token function">startVideoRecording</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>controller<span class="token punctuation">.</span>value<span class="token punctuation">.</span>isInitialized<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">showInSnackBar</span><span class="token punctuation">(</span><span class="token string">'请先选择一个摄像头'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 确定视频保存的路径</span>
    <span class="token keyword">final</span> Directory extDir <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getApplicationDocumentsDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> String dirPath <span class="token operator">=</span> <span class="token string">'${extDir.path}/Movies/flutter_test'</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">Directory</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>recursive<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> String filePath <span class="token operator">=</span> <span class="token string">'$dirPath/${timestamp()}.mp4'</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>controller<span class="token punctuation">.</span>value<span class="token punctuation">.</span>isRecordingVideo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果正在录制，则直接返回</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      videoPath <span class="token operator">=</span> filePath<span class="token punctuation">;</span>
      <span class="token keyword">await</span> controller<span class="token punctuation">.</span><span class="token function">startVideoRecording</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">on</span> CameraException <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">_showCameraException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> filePath<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  Future<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token function">stopVideoRecording</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>controller<span class="token punctuation">.</span>value<span class="token punctuation">.</span>isRecordingVideo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> controller<span class="token punctuation">.</span><span class="token function">stopVideoRecording</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">on</span> CameraException <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">_showCameraException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">await</span> <span class="token function">_startVideoPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  Future<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token function">_startVideoPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> VideoPlayerController vcontroller <span class="token operator">=</span>
    VideoPlayerController<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token function">File</span><span class="token punctuation">(</span>videoPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    videoPlayerListener <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>videoController <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> videoController<span class="token punctuation">.</span>value<span class="token punctuation">.</span>size <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Refreshing the state to update video player with the correct ratio.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mounted<span class="token punctuation">)</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        videoController<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span>videoPlayerListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    vcontroller<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>videoPlayerListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> vcontroller<span class="token punctuation">.</span><span class="token function">setLooping</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> vcontroller<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> videoController<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        imagePath <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        videoController <span class="token operator">=</span> vcontroller<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">await</span> vcontroller<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  Future<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token function">takePicture</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>controller<span class="token punctuation">.</span>value<span class="token punctuation">.</span>isInitialized<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">showInSnackBar</span><span class="token punctuation">(</span><span class="token string">'错误: 请先选择一个相机'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">final</span> Directory extDir <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getApplicationDocumentsDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> String dirPath <span class="token operator">=</span> <span class="token string">'${extDir.path}/Pictures/flutter_test'</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">Directory</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>recursive<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> String filePath <span class="token operator">=</span> <span class="token string">'$dirPath/${timestamp()}.jpg'</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>controller<span class="token punctuation">.</span>value<span class="token punctuation">.</span>isTakingPicture<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// A capture is already pending, do nothing.</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> controller<span class="token punctuation">.</span><span class="token function">takePicture</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">on</span> CameraException <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">_showCameraException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> filePath<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">_showCameraException</span><span class="token punctuation">(</span>CameraException e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">logError</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>code<span class="token punctuation">,</span> e<span class="token punctuation">.</span>description<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">showInSnackBar</span><span class="token punctuation">(</span><span class="token string">'Error: ${e.code}\n${e.description}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <blockquote><p>如果代码运行遇到困难，请直接查看<a href="https://pub.dev/packages/camera" target="_blank" rel="noopener noreferrer">camera官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></blockquote> <h2 id="_12-6-2-platformview-示例-webview"><a href="#_12-6-2-platformview-示例-webview" class="header-anchor">#</a> 12.6.2 PlatformView （示例：WebView）</h2> <p>如果我们在开发过程中需要使用一个原生组件，但这个原生组件在Flutter中很难实现时怎么办（如webview）？这时一个简单的方法就是将需要使用原生组件的页面全部用原生实现，在flutter中需要打开该页面时通过消息通道打开这个原生的页面。但是这种方法有一个最大的缺点，就是原生组件很难和Flutter组件进行组合。</p> <p>在 Flutter 1.0版本中，Flutter SDK中新增了<code>AndroidView</code>和<code>UIKitView</code> 两个组件，这两个组件的主要功能就是将原生的Android组件和iOS组件嵌入到Flutter的组件树中，这个功能是非常重要的，尤其是对一些实现非常复杂的组件，比如webview，这些组件原生已经有了，如果Flutter中要用，重新实现的话成本将非常高，所以如果有一种机制能让Flutter共享原生组件，这将会非常有用，也正因如此，Flutter才提供了这两个组件。</p> <p>由于<code>AndroidView</code>和<code>UIKitView</code> 是和具体平台相关的，所以称它们为PlatformView。需要说明的是将来Flutter支持的平台可能会增多，则相应的PlatformView也将会变多。那么如何使用Platform View呢？我们以Flutter官方提供的<a href="https://github.com/flutter/plugins/tree/master/packages/webview_flutter" target="_blank" rel="noopener noreferrer">webview_flutter插件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>为例：</p> <blockquote><p>注意，在本书写作之时，webview_flutter仍处于预览阶段，如您想在项目中使用它，请查看一下webview_flutter插件最新版本及动态。</p></blockquote> <ol><li><p>原生代码中注册要被Flutter嵌入的组件工厂，如webview_flutter插件中Android端注册webview插件代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">registerWith</span><span class="token punctuation">(</span><span class="token class-name">Registrar</span> registrar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   registrar<span class="token punctuation">.</span><span class="token function">platformViewRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerViewFactory</span><span class="token punctuation">(</span><span class="token string">&quot;webview&quot;</span><span class="token punctuation">,</span> 
   <span class="token class-name">WebViewFactory</span><span class="token punctuation">(</span>registrar<span class="token punctuation">.</span><span class="token function">messenger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>WebViewFactory</code>的具体实现请参考webview_flutter插件的实现源码，在此不再赘述。</p></li> <li><p>在Flutter中使用；打开Flutter中文社区首页。</p> <div class="language-dart extra-class"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">PlatformViewRoute</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">WebView</span><span class="token punctuation">(</span>
      initialUrl<span class="token punctuation">:</span> <span class="token string">&quot;https://flutterchina.club&quot;</span><span class="token punctuation">,</span>
      javascriptMode<span class="token punctuation">:</span> JavascriptMode<span class="token punctuation">.</span>unrestricted<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运行效果如图12-5所示：</p> <p><img src="data:image/jpeg;base64,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" alt="12-5"></p></li></ol> <p>注意，使用PlatformView的开销是非常大的，因此，如果一个原生组件用Flutter实现的难度不大时，我们应该首选Flutter实现。</p> <p>另外，PlatformView的相关功能在作者写作时还处于预览阶段，可能还会发生变化，因此，读者如果需要在项目中使用的话，应查看一下最新的文档。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/chapter12/ios_implement.html" class="prev">
        12.5 插件开发：iOS端API实现
      </a></span> <span class="next"><a href="/chapter13/multi_languages_support.html">
        13.1 让App支持多语言
      </a>
      →
    </span></p></div> <div class="copyright"> 版权所有，禁止私自转发、克隆网站。</div> <div class="f-links" style="text-align:center;"><a title="点击购买" target="_blank"> 购买实体书
        </a> |
        <a href="https://github.com/flutterchina">
          Flutter中国开源项目
        </a> |
        <a href="/join_us.html">
          和作者做同事
        </a></div></main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b60cbd9e.js" defer></script><script src="/assets/js/21.70d8a941.js" defer></script><script src="/assets/js/2.fb4ba5aa.js" defer></script><script src="/assets/js/35.d79277d5.js" defer></script>
  </body>
</html>
